<ion-header>
  <ion-toolbar mode="ios">
    <ion-buttons slot="start">
      <ion-button (click)="close()">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="toolbarTitle" text-wrap>{{'reminder.personal_reminder'| translate }}</ion-title>
   <!--  <ion-buttons slot="end">
      <ion-button  slot="end" fill="clear" (click)="submit()">
        <ion-icon name="checkmark" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons> -->
  </ion-toolbar>
</ion-header>

<!-- {{(this.isNewEvent)? ('button.add' | translate): ('button.ok' | translate)}} -->

<ion-content fullscreen>
  <form (ngSubmit)="submit()" [formGroup]="form">
  <div class="whiteBackground">
    <ion-card class="cardProfile">
      <ion-list>
        <ion-item>
          <ion-label  stacked>
            {{'reminder.field_title' | translate}}
            <ion-note *ngIf="this.isSubmittedTitle && this.form.get('title').invalid" class="error " color="danger">{{ 'error_required' | translate}}</ion-note>
          </ion-label>
          <ion-input formControlName="title" class="textMedium" required  [placeholder]="this.titlePlaceholder"></ion-input>
        </ion-item>
        <ion-item lines="none">
          <ion-label  stacked>
            {{'reminder.field_notes' | translate}}
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-textarea formControlName="description" class="textMediumLeft" placeholder="{{'reminder.placeholder_comments' | translate}}"></ion-textarea>
        </ion-item>
      </ion-list>
    </ion-card>
  </div>
  <ion-card class="cardProfile">
    <ion-list>
      
      <ion-item>
        <ion-label stacked>
         {{'reminder.field_start' | translate}}
          <ion-note *ngIf="this.isSubmittedStartDate && this.form.get('start_date').invalid" class="error " color="danger">{{ 'error_required' | translate}}</ion-note>
        </ion-label>
        <ion-datetime-button slot="end" datetime="start_date"></ion-datetime-button>
      </ion-item>


      <ion-modal [keepContentsMounted]="true" [backdropDismiss]="false">
        <ng-template>
          <ion-datetime [locale]="this.locale" presentation="date" id="start_date" [min]="this.date" [max]="dateMax"  (ionChange)="this.isSubmittedStartDate = false"  formControlName="start_date"></ion-datetime>
          <ion-buttons mode="ios" slot="buttons" style="background-color: white;">
            <ion-button class="btn-style-1" mode="ios" color="danger"  slot="start"></ion-button>
            <ion-button class="btn-style-1" mode="ios" style="width: 50px;"></ion-button>
            <ion-button class="btn-style-1" mode="ios" color="primary" slot="end" (click)="close();">{{'button.confirm' | translate}}</ion-button>
          </ion-buttons>
        </ng-template>
      </ion-modal>
      

      <ion-item>
        <ion-label  stacked>
          {{ 'reminder.field_end' | translate}}
          <ion-note *ngIf="this.isSubmittedDuration && this.form.get('end_date').invalid" (ionInput)="isSubmittedDuration = false"  class="error " color="danger">{{ getErrorEndDate() }}</ion-note>
        </ion-label>
        <ion-datetime-button slot="end" datetime="end_date"></ion-datetime-button>
      </ion-item>
      <ion-modal [keepContentsMounted]="true" [backdropDismiss]="false">
        <ng-template>
          <ion-datetime [locale]="this.locale" presentation="date" id="end_date" (ionChange)="this.isSubmittedDuration = false; checkTreatmentDates()" formControlName="end_date" [min]="this.date" [max]="dateMax"></ion-datetime>
          <ion-buttons mode="ios" slot="buttons" style="background-color: white;">
            <ion-button class="btn-style-1" mode="ios" color="danger"  slot="start"></ion-button>
            <ion-button class="btn-style-1" mode="ios" style="width: 50px;"></ion-button>
            <ion-button class="btn-style-1" mode="ios" color="primary" slot="end" (click)="close();">{{'button.confirm' | translate}}</ion-button>
          </ion-buttons>
        </ng-template>
      </ion-modal>

      <ion-item>
        <ion-label  stacked>
          {{ 'reminder.field_time' | translate}}
          <ion-note *ngIf="this.isSubmittedTimes && this.times.length ==0 " class="error " color="danger">{{ 'error_required' | translate}}</ion-note>
        </ion-label>
        <ion-datetime-button slot="end" datetime="time"></ion-datetime-button>
        <ion-icon slot="end" color="primary" name="add-circle-outline"></ion-icon>
      </ion-item>

      <ion-popover #datetimePopover [keepContentsMounted]="true" side="left" alignment="end">
        <ng-template>
          <ion-datetime mode="ios"  #datetime id="time" hourCycle="h23" [preferWheel]="true"  [locale]="this.locale" presentation="time" displayFormat="HH:mm" (ionChange)="this.isSubmittedTimes = false" formControlName="time"></ion-datetime>
          <ion-buttons slot="buttons">
            <ion-button color="danger" (click)="closeTimeAlert($event);" slot="start">{{'notifications.close' | translate}}</ion-button>
            <ion-button style="width: 50px;"></ion-button>
            <ion-button color="primary" (click)="inputTimes($event);" slot="end">{{'button.add' | translate}}</ion-button>
          </ion-buttons>
        </ng-template>
      </ion-popover>
      <div >
        <ng-container>
          <ion-chip *ngFor="let time of this.times;let i = index">
            <ion-label class="txtTitleGoals">{{ this.dateService.format24h(time)}} </ion-label>
            <ion-icon name="close-circle" color="primary" (click)="removeTime(time)"></ion-icon>
          </ion-chip>
        </ng-container>
      </div>


      <ion-item lines="none">

        <ion-label  stacked>
          {{'reminder.field_repeat' | translate}}
          <ion-note *ngIf="this.isSubmittedTimes && this.times.length ==0 " class="error " color="danger">{{ 'error_required' | translate}}</ion-note>
        </ion-label>

        <ion-select  class="txtTitleGoals" interface="action-sheet" (ionChange)="this.selectedFrequency()" cancelText="{{'button.cancel' | translate}}" formControlName="frequency"  okText="{{'button.ok' | translate}}" toggleIcon="assets/icons/challenge_card_btn.svg">
          <ion-select-option value="daily">{{'reminder.frequency.daily' | translate}}</ion-select-option>
          <ion-select-option value="custom">{{'reminder.frequency.custom' | translate}}</ion-select-option>
        </ion-select>
      </ion-item>
    </ion-list>
  </ion-card>

  <ion-card class="cardProfile" *ngIf="this.frequencySeleted === 'custom' " style="margin-bottom: 20%;">
    <div>
      <ion-item (click)="expandItem()"  *ngIf="this.expanded" lines="none">

        <ion-label  stacked>
          {{'reminder.week_day' | translate}}        
        </ion-label>
        <ion-icon name="chevron-up-outline" slot="end" size="small"></ion-icon>
      </ion-item>
      <ion-item (click)="expandItem()"  *ngIf="!this.expanded"  lines="none">

        <ion-label  stacked>
          {{'reminder.week_day' | translate}}        
        </ion-label>

        <ion-icon name="chevron-down-outline" slot="end" size="small"></ion-icon>
      </ion-item>

      <!-- ACORDION -->
      <app-expandable expandHeight="500px" [expanded]="this.expanded">
        <ion-list *ngFor="let e of days;let i= index">
          <ion-item [lines]="(i==6)? 'none':'' ">
            <ion-checkbox labelPlacement="end" color="primary" (ionChange)="setDay($event, e, i)"
              [formControlName]=" 'day'+(i+1)">
              <ion-text>
                <p class="reminder-fields-txt">{{'reminder.day.day'+(i+1) | translate}}</p>
              </ion-text>
            </ion-checkbox>
          </ion-item>
        </ion-list>
      </app-expandable>

    </div>
  </ion-card>

</form>

<section *ngIf="!this.isNewEvent">
  <ion-button class="deleteButton"  expand="block" (click)="presentAlertConfirm()">{{ 'reminder.button_delete' | translate}}</ion-button>
  </section>

  
</ion-content>

<ion-footer mode="ios">

  <div style="background-color: var(--default-bkg);" style="display: flex; justify-content: center; margin-bottom: 50px;">
    <ion-button (click)="submit()" color="primary" shape="round" class="floating-button ion-margin" >
      {{'reminder.save' | translate}}
      <!-- <ion-icon style="padding-left: 2%;"  src="../../assets/icons/notifications_reminder.svg"></ion-icon> -->
    </ion-button>
  </div>

  
</ion-footer>