<ion-header>
  <ion-toolbar mode="ios">
    <ion-buttons slot="start">
      <ion-back-button text="" (click)="backButton()"></ion-back-button>
    </ion-buttons>

    <ion-thumbnail slot="start">
      <app-aspect-ratio [ratio]="{w:1, h:1}">
        <app-image-shell animation="spinner" [src]="(this.staff?.image)? this.staff?.image: this.staff?.temporaryUrl" [alt]="'Sample Image'"
          class="img-wrapper-doctors"></app-image-shell>
      </app-aspect-ratio>
    </ion-thumbnail>

    <ion-label>
      <h3 style="margin-left: 5px;" class="user-name">
        <app-text-shell
          class="user-name"
          [data]="this.staff?.name"
          animation="bouncing"
        ></app-text-shell>
      </h3>

    </ion-label>

  </ion-toolbar>
</ion-header>

<ion-content #content  [scrollEvents]="true" (ionScroll)="onScroll($event)" >

    <ion-fab [ngClass]="(this.footerHidden)? 'scrollHiden':'slideNone'" vertical="bottom" horizontal="end" slot="fixed">
      <ion-fab-button (click)="scrollToBottom()" mode="ios" translucent="true" color="secondary" size="small" >
        <ion-icon name="chevron-down-sharp"></ion-icon>
      </ion-fab-button>
    </ion-fab>

    <div #contentArea>
      <ion-infinite-scroll threshold="50px" position="top" (ionInfinite)="getMessagesList(true,$event)">
        <ion-infinite-scroll-content
          loadingSpinner="bubbles"
          loadingText="{{'chat.loading'| translate}}">
        </ion-infinite-scroll-content>
      </ion-infinite-scroll>

      <ion-list no-lines>
        <div  *ngFor="let message of this.messagesList; let i = index">
          <ion-badge mode="ios" *ngIf="this.currentPage == this.lastPage && i==0" color="primary">{{'chat.end'| translate}}</ion-badge>
          <ion-badge mode="ios" *ngIf="message.showDay" color="primary">{{formatDate(message?.created_at)}}</ion-badge>
          <ion-item class="itemChat">
            <ion-label>
              <chat-bubble [chatMessage]="message"></chat-bubble>
            </ion-label>
          </ion-item>
          <!--<ion-item >
            <ion-label>
              <chat-bubble [chatMessage]="message"></chat-bubble>
            </ion-label>
          </ion-item>
          <ion-item *ngFor="let message of this.messageUploadList">
            <chat-bubble [chatMessage]="message"></chat-bubble>
          </ion-item>-->
        </div>
      </ion-list>
    </div>
</ion-content>
<ion-footer>
  <div class='yellow-box'>
    <strong>{{'conversation.warning' | translate}}</strong>{{'conversation.warning_text' | translate}}
  </div>
  <ion-toolbar>
    <ion-item no-lines>
      <ion-buttons >
        <!--<ion-button (click)="selectImageSource()">
          <ion-icon icon-start name="add-outline"></ion-icon>
          <input
            type="file"
            #fileInput
            (change)="uploadFileFromBrowser($event)"
            hidden="true"
            accept="image/*, application/pdf, video/*, audio/*, .doc,.docx,application/msword"
          />
        </ion-button>-->
        <app-file-upload-v2 #uploadFile1 (numFilesChange)="sendFile()"></app-file-upload-v2>
      </ion-buttons>
      <div item-content style="width:120%!important" >
        <elastic-textarea #txtChat placeholder="{{ 'conversation.placeholder' | translate}}">
          <ion-input  lineHeight="20" maxExpand="8" style="width:120%!important"></ion-input>
        </elastic-textarea>
      </div>
      <ion-buttons >
        <app-file-upload-v2 color="dark" icon="camera-outline" #uploadFile2 [enableFiles]="false" [enablePhotos]="false" (numFilesChange)="sendFile2()"></app-file-upload-v2>
         <!--<ion-button (click)="this.addImage()">
          <ion-icon name="camera-outline"></ion-icon>
        </ion-button>
         <ion-button  (click)="this.addAudio()">
          <ion-icon name="mic-outline"></ion-icon>
        </ion-button> -->
        <ion-button [disabled]="txtChat.content.trim().length<1 || !btnEnabled" slot="end" (click)="this.send()">
          <ion-icon name="send"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-item>
   </ion-toolbar>
</ion-footer>

